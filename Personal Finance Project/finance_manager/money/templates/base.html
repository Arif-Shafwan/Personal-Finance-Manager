<!DOCTYPE html>
<html lang="en" class="min-h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Money Manager{% endblock %}</title>

  <!-- Tailwind (dark mode via class) -->
  <script>
    window.tailwind = { config: { darkMode: 'class' } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Global color tokens -->
  <style>
    :root{
      /* Light theme */
      --bg:       #ffffff;   /* page background */
      --fg:       #0f172a;   /* text color (slate-900) */
      --muted:    #475569;   /* secondary text (slate-600) */
      --card:     #f8fafc;   /* card bg (slate-50) */
      --border:   #e2e8f0;   /* borders (slate-200) */
      --input:    #ffffff;   /* inputs */
      --axis:     #334155;   /* charts axis (slate-700) */
      --grid:     rgba(148,163,184,.30); /* charts grid */
    }
    .dark{
      /* Dark theme */
      --bg:       #0b1220;   /* deep navy */
      --fg:       #e5e7eb;   /* slate-200 */
      --muted:    #94a3b8;   /* slate-400 */
      --card:     #0f172a;   /* slate-900 */
      --border:   #1f2937;   /* slate-800 */
      --input:    #0b1220;   /* inputs */
      --axis:     #cbd5e1;   /* slate-300 */
      --grid:     rgba(148,163,184,.20); /* charts grid */
    }
  </style>

  <script>
    // apply saved theme early
    (function(){
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = saved ? saved === 'dark' : prefersDark;
      document.documentElement.classList.toggle('dark', isDark);
    })();
    function toggleTheme(){
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
  </script>

  <!-- helper available BEFORE content scripts run -->
  <script>
    window.themeVars = function(){
      const s = getComputedStyle(document.documentElement);
      return {
        axis: s.getPropertyValue('--axis').trim(),
        grid: s.getPropertyValue('--grid').trim()
      };
    };
  </script>
</head>
<body class="min-h-screen flex flex-col bg-[var(--bg)] text-[var(--fg)]">
  <header class="border-b border-[var(--border)]">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="font-semibold tracking-tight">ðŸ’¸ Money Manager</a>
      <nav class="flex items-center gap-3 text-[var(--muted)]">
        {% if user.is_authenticated %}
          <a href="/" class="hover:text-[var(--fg)]">Dashboard</a>
          <a href="/transactions/" class="hover:text-[var(--fg)]">Transactions</a>
          <a href="/budgets/" class="hover:text-[var(--fg)]">Budgets</a>
          <a href="/categories/" class="hover:text-[var(--fg)]">Categories</a>
          <a href="/accounts/" class="hover:text-[var(--fg)]">Accounts</a>
          <a href="/logout/" class="text-rose-600 dark:text-rose-300 hover:underline">Logout</a>
        {% else %}
          <a href="/login/" class="hover:text-[var(--fg)]">Login</a>
          <a href="/signup/" class="hover:text-[var(--fg)]">Sign up</a>
        {% endif %}
        <button type="button" onclick="toggleTheme()"
          class="ml-2 px-2 py-1 rounded border border-[var(--border)] text-sm text-[var(--fg)] hover:bg-black/5 dark:hover:bg-white/5">
          <span class="inline dark:hidden">â˜¾ Dark</span>
          <span class="hidden dark:inline">â˜€ï¸Ž Light</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6 flex-1 w-full">{% block content %}{% endblock %}</main>
  <footer class="border-t border-[var(--border)] py-6 text-center text-[var(--muted)]">Â© {{ now|date:"Y" }} Personal Finance</footer>

    <!-- Chart helper (reads CSS vars) -->
    <script>
    window.themeVars = function(){
        const s = getComputedStyle(document.documentElement);
        return {
        axis: s.getPropertyValue('--axis').trim(),
        grid: s.getPropertyValue('--grid').trim()
        };
    };
    </script>
</body>
</html>